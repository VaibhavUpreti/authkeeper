{"version":3,"file":"authkeeper.js","mappings":"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","sources":["webpack://authkeeper/webpack/universalModuleDefinition","webpack://authkeeper/webpack/bootstrap","webpack://authkeeper/webpack/runtime/define property getters","webpack://authkeeper/webpack/runtime/hasOwnProperty shorthand","webpack://authkeeper/webpack/runtime/make namespace object","webpack://authkeeper/./lib/client.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"authkeeper\"] = factory();\n\telse\n\t\troot[\"authkeeper\"] = factory();\n})(self, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","class OAuthClient {\n    constructor(config) {\n      this.client_id = config.client_id;\n      this.client_secret = config.client_secret;\n      this.redirect_uri = config.redirect_uri;\n      this.authorization_url = config.authorization_url;\n      this.token_url = config.token_url;\n      this.scope = config.scope;\n    }\n  \n    generateRandomString(length = 28) {\n      const array = new Uint32Array(length);\n      window.crypto.getRandomValues(array);\n      return Array.from(array, dec => ('0' + dec.toString(16)).substr(-2)).join('');\n    }\n  \n    // base64url encode\n    base64urlencode(str) {\n      return btoa(String.fromCharCode.apply(null, new Uint8Array(str)))\n        .replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n    }\n  \n    // PKCE helper functions\n    async pkceChallengeFromVerifier(v) {\n      const hashed = await this.sha256(v);\n      return this.base64urlencode(hashed);\n    }\n  \n    sha256(plain) {\n      const encoder = new TextEncoder();\n      const data = encoder.encode(plain);\n      return window.crypto.subtle.digest('SHA-256', data);\n    }\n  \n    // Start OAuth flow (Authorization Code + PKCE)\n    async startAuthFlow() {\n      const state = this.generateRandomString();\n      localStorage.setItem(\"pkce_state\", state);\n  \n      const code_verifier = this.generateRandomString();\n      localStorage.setItem(\"pkce_code_verifier\", code_verifier);\n  \n      const code_challenge = await this.pkceChallengeFromVerifier(code_verifier);\n  \n      const url = `${this.authorization_url}?response_type=code&client_id=${encodeURIComponent(this.client_id)}&state=${encodeURIComponent(state)}&scope=${encodeURIComponent(this.scope)}&redirect_uri=${encodeURIComponent(this.redirect_uri)}&code_challenge=${encodeURIComponent(code_challenge)}&code_challenge_method=S256`;\n  \n      window.location = url;\n    }\n  \n    // Handle OAuth callback\n    async handleCallback() {\n      const q = this.parseQueryString(window.location.search.substring(1));\n  \n      if (q.error) {\n        alert(\"Error: \" + q.error);\n      }\n  \n      if (q.code) {\n        if (localStorage.getItem(\"pkce_state\") !== q.state) {\n          alert(\"Invalid state\");\n        } else {\n          await this.exchangeAuthCodeForToken(q.code);\n        }\n      }\n  \n      localStorage.removeItem(\"pkce_state\");\n      localStorage.removeItem(\"pkce_code_verifier\");\n    }\n  \n    async exchangeAuthCodeForToken(code) {\n      const code_verifier = localStorage.getItem(\"pkce_code_verifier\");\n  \n      const params = new URLSearchParams();\n      params.append('grant_type', 'authorization_code');\n      params.append('code', code);\n      params.append('client_id', this.client_id);\n      params.append('redirect_uri', this.redirect_uri);\n      params.append('code_verifier', code_verifier);\n  \n      try {\n        const response = await fetch(this.token_url, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n          },\n          body: params.toString()\n        });\n        const data = await response.json();\n        if (response.ok) {\n          document.getElementById(\"access_token\").innerText = data.access_token;\n          document.getElementById(\"token\").classList.remove(\"hidden\");\n        } else {\n          document.getElementById(\"error_details\").innerText = data.error;\n          document.getElementById(\"error\").classList.remove(\"hidden\");\n        }\n      } catch (err) {\n        console.error(\"Error exchanging auth code:\", err);\n      }\n    }\n  \n    // Helper function to parse query string\n    parseQueryString(query) {\n      const params = new URLSearchParams(query);\n      const result = {};\n      for (let [key, value] of params.entries()) {\n        result[key] = value;\n      }\n      return result;\n    }\n  }\n  \n  export { OAuthClient };\n\n  "],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","OAuthClient","constructor","config","this","client_id","client_secret","redirect_uri","authorization_url","token_url","scope","generateRandomString","length","array","Uint32Array","window","crypto","getRandomValues","Array","from","dec","toString","substr","join","base64urlencode","str","btoa","String","fromCharCode","apply","Uint8Array","replace","pkceChallengeFromVerifier","v","hashed","sha256","plain","data","TextEncoder","encode","subtle","digest","startAuthFlow","state","localStorage","setItem","code_verifier","code_challenge","url","encodeURIComponent","location","handleCallback","q","parseQueryString","search","substring","error","alert","code","getItem","exchangeAuthCodeForToken","removeItem","params","URLSearchParams","append","response","fetch","method","headers","body","json","ok","document","getElementById","innerText","access_token","classList","remove","err","console","query","result","entries"],"sourceRoot":""}