!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.authKeeper=t():e.authKeeper=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};async function n(e,t){const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(t)});if(!n.ok)throw new Error(`Error: ${n.statusText}`);return n.json()}e.r(t),e.d(t,{default:()=>r});const r=class{constructor({clientId:e,redirectUri:t,authEndpoint:n,tokenEndpoint:r,grantType:o,clientSecret:i=null}){this.clientId=e,this.redirectUri=t,this.authEndpoint=n,this.tokenEndpoint=r,this.grantType=o,this.clientSecret=i}async startAuthFlow(){const e=this.generateRandomString();if(localStorage.setItem("oauth_state",e),"pkce"===this.grantType){const{codeVerifier:t,codeChallenge:n}=await async function(){const e=function(){const e=new Uint32Array(28);return window.crypto.getRandomValues(e),Array.from(e,(e=>("0"+e.toString(16)).substr(-2))).join("")}();return{codeVerifier:e,codeChallenge:await async function(e){const t=await async function(e){const t=(new TextEncoder).encode(e);return window.crypto.subtle.digest("SHA-256",t)}(e);return btoa(String.fromCharCode.apply(null,new Uint8Array(t))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(e)}}();return localStorage.setItem("pkce_code_verifier",t),`${this.authEndpoint}?response_type=code&client_id=${encodeURIComponent(this.clientId)}&state=${encodeURIComponent(e)}&redirect_uri=${encodeURIComponent(this.redirectUri)}&code_challenge=${encodeURIComponent(n)}&code_challenge_method=S256`}if("authorization_code"===this.grantType)return`${this.authEndpoint}?response_type=code&client_id=${encodeURIComponent(this.clientId)}&state=${encodeURIComponent(e)}&redirect_uri=${encodeURIComponent(this.redirectUri)}`;throw new Error("Unsupported grant type")}async handleCallback(e){const t=localStorage.getItem("oauth_state");if(e.state!==t)throw new Error("Invalid state parameter");const r={grant_type:this.grantType,code:e.code,client_id:this.clientId,redirect_uri:this.redirectUri};"pkce"===this.grantType?r.code_verifier=localStorage.getItem("pkce_code_verifier"):"authorization_code"===this.grantType&&this.clientSecret&&(r.client_secret=this.clientSecret);const o=await n(this.tokenEndpoint,r);return localStorage.removeItem("oauth_state"),"pkce"===this.grantType&&localStorage.removeItem("pkce_code_verifier"),o}async refreshToken(e){const t={grant_type:"refresh_token",refresh_token:e,client_id:this.clientId,...this.clientSecret&&{client_secret:this.clientSecret}};return await n(this.tokenEndpoint,t)}generateRandomString(){const e=new Uint32Array(28);return window.crypto.getRandomValues(e),Array.from(e,(e=>("0"+e.toString(16)).substr(-2))).join("")}};return t})()));
//# sourceMappingURL=auth-keeper.js.map