!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["auth-keeper"]=t():e["auth-keeper"]=t()}(self,(()=>{return e={509:(e,t,o)=>{const r=o(524);(t=e.exports=new r).PKCE=r,t.testLibrary=async function(e){try{console.log("Testing PKCE Library...");const o=await t.startAuthFlow(e);console.log("Generated Auth URL:",o);const r={state:localStorage.getItem("pkce_state"),code:"sample_auth_code"},n=await t.handleCallback(e,r);console.log("Token Response:",n);const s=await t.refreshToken(e,"sample_refresh_token");console.log("Refresh Token Response:",s),console.log("Library Tested Successfully")}catch(e){console.error("Error Testing Library:",e)}}},524:e=>{e.exports=class{constructor(){}generateRandomString(){const e=new Uint32Array(28);return window.crypto.getRandomValues(e),Array.from(e,(e=>("0"+e.toString(16)).substr(-2))).join("")}async sha256(e){const t=(new TextEncoder).encode(e);return window.crypto.subtle.digest("SHA-256",t)}base64urlencode(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async pkceChallengeFromVerifier(e){const t=await this.sha256(e);return this.base64urlencode(t)}parseQueryString(e){return Object.fromEntries(new URLSearchParams(e))}sendPostRequest(e,t){return new Promise(((o,r)=>{const n=new XMLHttpRequest;n.open("POST",e,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onload=()=>{try{const e=JSON.parse(n.responseText);200===n.status?o(e):r(e)}catch(e){r({error:"Invalid JSON response"})}},n.onerror=()=>r({error:"Request failed"});const s=new URLSearchParams(t).toString();n.send(s)}))}async startAuthFlow(e){const t=this.generateRandomString();localStorage.setItem("pkce_state",t);const o=this.generateRandomString();localStorage.setItem("pkce_code_verifier",o);const r=await this.pkceChallengeFromVerifier(o);return`${e.authorization_endpoint}?response_type=code&client_id=${encodeURIComponent(e.client_id)}&state=${encodeURIComponent(t)}&scope=${encodeURIComponent(e.requested_scopes)}&redirect_uri=${encodeURIComponent(e.redirect_uri)}&code_challenge=${encodeURIComponent(r)}&code_challenge_method=S256`}async handleCallback(e,t){if(localStorage.getItem("pkce_state")!==t.state)throw new Error("State does not match.");const o=localStorage.getItem("pkce_code_verifier"),r={grant_type:"authorization_code",code:t.code,client_id:e.client_id,redirect_uri:e.redirect_uri,code_verifier:o},n=await this.sendPostRequest(e.token_endpoint,r);return localStorage.removeItem("pkce_state"),localStorage.removeItem("pkce_code_verifier"),n}async refreshToken(e,t){const o={grant_type:"refresh_token",refresh_token:t,client_id:e.client_id};return await this.sendPostRequest(e.token_endpoint,o)}}}},t={},function o(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,o),s.exports}(509);var e,t}));
//# sourceMappingURL=auth-keeper.js.map